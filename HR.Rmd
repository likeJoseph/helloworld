---
title: "HR Attrition"
author: "igchong"
date: '2022 3 6 '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

```{r calcs, echo=FALSE}
library(tidyverse)
library(randomForest)
library(party)
library(caret)
library(ggthemes)
library(plotly)
library(htmlwidgets)
library(DT)


#load our data sets
commute_data_raw <- read.csv("data/commute_data.csv")
hr_performance_data_raw <- read.csv("data/hr_employees_performance_data.csv")
personal_data_raw <- read.csv("data/personal_data.csv", stringsAsFactors = FALSE)
rnd_performance_data_raw <- read.csv("data/research_and_development_employees_performance_data.csv")
sales_performance_data_raw <- read.csv("data/sales_employees_performance_data.csv")

# spread is like dcast in data.table
personal_data <- spread(data = personal_data_raw, key = Variable, value = Value)

 
hr_performance_data <- select(hr_performance_data_raw, -X)
rnd_performance_data <- select(rnd_performance_data_raw, -X)
sales_performance_data <- select(sales_performance_data_raw, -X)
commute_data <- select(commute_data_raw, -X)

hr_performance_data$Department <- "HR"
rnd_performance_data <- mutate(rnd_performance_data,
                               Department = "Research and Development")
sales_performance_data <- sales_performance_data %>%
  mutate(Department = "Sales")

performance_data <- rbind(hr_performance_data, rnd_performance_data,
                          sales_performance_data)

performance_data <- mutate(performance_data, 
                           Department = as.factor(Department))

employee_data <- performance_data %>%
  left_join(commute_data, by = "EmployeeNumber") %>%
  inner_join(personal_data, by = "EmployeeNumber")




dataSpliter <- function(employee_data, p = 0.7){
  set.seed(10)
  num_obs <- dim(employee_data)[1]
  draw <- sample(1:num_obs, replace = FALSE)
  draw_split <- floor(num_obs*p)
  train <- employee_data[draw[1:draw_split],]
  test <- employee_data[draw[(draw_split+1):num_obs], ]
  
  result <- list(train = train, test = test)
  return(result)
}


employee_data <- as.data.frame(unclass(employee_data),
                               stringsAsFactors = TRUE)

employee_allset <- dataSpliter(employee_data)
employee_trainset <- employee_allset$train
employee_testset <- employee_allset$test
```

```{r models}
rand_forest <- randomForest(data = employee_trainset,
                            Attrition ~ .,
                            importance = TRUE)
predict_forest <- predict(rand_forest, employee_testset)

confusionMatrix(predict_forest, 
                employee_testset$Attrition,
                positive = "Yes")

```

```{r graphs, echo=FALSE}
p1 <- ggplot(data = employee_data) +
  geom_bar(aes(x = OverTime, fill = Attrition), 
           position ="fill") +
  ggtitle("Percentage Attrition by Overtime") +
  scale_fill_colorblind()

dp1 <- ggplotly(p1)
dp1
```

#Tables
```{r tables, echo=FALSE}
employees_current <- employee_data %>% filter(Attrition == "No")

current_prediction_forest <- predict(rand_forest,
                                     employees_current)
employees_current$PredictedAttrition2 <- current_prediction_forest
likely_to_leave_list2 <- employees_current %>%
  filter(PredictedAttrition2 == "Yes")

datatable(likely_to_leave_list2)
```

연습 인라이 r `r likely_to_leave_list2[1,3]`

```{python}
import pandas as pd
3+5
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
# echo False
plot(pressure)
```



Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
